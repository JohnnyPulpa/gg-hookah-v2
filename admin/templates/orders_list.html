{% extends "base.html" %}
{% block title %}GG HOOKAH â€” Orders{% endblock %}
{% block sidebar_active %}orders{% endblock %}

{% block extra_styles %}
<style>
    .toolbar {
        display: flex; justify-content: space-between; align-items: center;
        margin-bottom: 16px;
    }
    .toolbar .count { color: #8892a4; font-size: 14px; }
    .toolbar a {
        color: #F28C18; text-decoration: none; font-size: 13px;
        padding: 6px 14px; border: 1px solid #F28C18; border-radius: 6px;
    }
    .toolbar a:hover { background: rgba(242, 140, 24, 0.1); }

    .orders-table {
        width: 100%; border-collapse: collapse; font-size: 13px;
    }
    .orders-table th {
        text-align: left; padding: 10px 12px; color: #8892a4;
        border-bottom: 1px solid #0f3460; font-weight: 600; font-size: 12px;
        text-transform: uppercase; letter-spacing: 0.5px;
    }
    .orders-table td {
        padding: 10px 12px; border-bottom: 1px solid rgba(15, 52, 96, 0.5);
        vertical-align: middle;
    }
    .orders-table tr:hover { background: rgba(242, 140, 24, 0.04); }
    .orders-table tr { cursor: pointer; }

    .status-badge {
        display: inline-block; padding: 3px 10px; border-radius: 12px;
        font-size: 11px; font-weight: 600; color: white;
    }
    .deposit-badge {
        display: inline-block; font-size: 12px;
    }
    .flag-late {
        display: inline-block; background: #e74c3c; color: white;
        padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;
        margin-left: 4px;
    }
    .flag-ending {
        display: inline-block; background: #f39c12; color: white;
        padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600;
        margin-left: 4px;
    }
    .timer { color: #e74c3c; font-weight: 700; }
    .timer.ok { color: #2ecc71; }
</style>
{% endblock %}

{% block content %}
    <h2>{% if show_all %}All Orders{% else %}Active Orders{% endif %}</h2>

    <div class="toolbar">
        <span class="count">{{ orders|length }} order(s)</span>
        {% if show_all %}
            <a href="{{ url_for('orders.orders_list') }}">Show active only</a>
        {% else %}
            <a href="{{ url_for('orders.orders_list', all='1') }}">Show all</a>
        {% endif %}
    </div>

    {% if orders %}
    <table class="orders-table">
        <thead>
            <tr>
                <th>Order</th>
                <th>Status</th>
                <th>Deposit</th>
                <th>Phone</th>
                <th>Address</th>
                <th>Hookahs</th>
                <th>Mix</th>
                <th>ETA / Timer</th>
                <th>Flags</th>
            </tr>
        </thead>
        <tbody>
            {% for o in orders %}
            <tr onclick="window.location='{{ url_for('orders.order_detail', order_id=o.id) }}'">
                <td><strong>#{{ o.id_short }}</strong></td>
                <td>
                    <span class="status-badge" style="background: {{ o.status_color }}">
                        {{ o.status }}
                    </span>
                </td>
                <td>
                    {% if o.deposit_type == 'passport' %}
                        <span class="deposit-badge">ðŸªª Passport{% if o.passport_photo_url %} âœ…{% endif %}</span>
                    {% elif o.deposit_type == 'cash' %}
                        <span class="deposit-badge">ðŸ’µ {{ o.deposit_amount_gel or 100 }}â‚¾</span>
                    {% else %}
                        <span class="deposit-badge" style="color: #8892a4;">â€”</span>
                    {% endif %}
                </td>
                <td>{{ o.phone or 'â€”' }}</td>
                <td>{{ (o.address_text or 'â€”')[:30] }}</td>
                <td>{{ o.hookah_count }}</td>
                <td>{{ o.mix_name or 'â€”' }}</td>
                <td>
                    {% if o.remaining_min is not none %}
                        <span class="timer {{ 'ok' if o.remaining_min > 30 else '' }}">
                            {{ o.remaining_min }} min
                        </span>
                    {% elif o.promised_eta_text %}
                        {{ o.promised_eta_text }}
                    {% elif o.promised_time %}
                        {{ o.promised_time.strftime('%H:%M') if o.promised_time else 'â€”' }}
                    {% else %}
                        â€”
                    {% endif %}
                </td>
                <td>
                    {% if o.is_late_order %}<span class="flag-late">LATE</span>{% endif %}
                    {% if o.remaining_min is not none and o.remaining_min < 30 and o.status == 'SESSION_ACTIVE' %}
                        <span class="flag-ending">ENDING</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <div class="icon">ðŸ“­</div>
        <p>No {% if not show_all %}active {% endif %}orders yet.</p>
    </div>
    {% endif %}
{% endblock %}
